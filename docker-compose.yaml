services:
  subtensor:
    build:
      context: .
      dockerfile: docker/subtensor/Dockerfile
    container_name: subtensor_machine
    ports:
      - "9945:9945"  # Expose port 9945
      - "9946:9946"  # Expose port 9946
      - "30334:30334"  # Expose internal communication port
      - "30335:30335"  # Expose internal communication port
    networks:
      - subtensor_network

  subnet:
    build:
      context: .
      dockerfile: docker/subnet/Dockerfile
    container_name: subnet_machine
    depends_on:
      - subtensor
    networks:
      - subtensor_network
    environment:
      - COLDKEY_PASSWORD=your_coldkey_password
      - HOTKEY_PASSWORD=your_hotkey_password

  miner:
    build:
      context: .
      dockerfile: docker/miner/Dockerfile
    container_name: miner_machine
    ports:
      - "8093:8093"
    depends_on:
      validator:
        condition: service_healthy
    networks:
      - subtensor_network
    environment:
      - COLDKEY_PASSWORD=your_coldkey_password
      - HOTKEY_PASSWORD=your_hotkey_password

  validator:
    build:
      context: .
      dockerfile: docker/validator/Dockerfile
    container_name: validator_machine
    ports:
      - "8000:8000"
      - "8092:8092"
    depends_on:
      - subnet
    networks:
      - subtensor_network
    environment:
      - COLDKEY_PASSWORD=your_coldkey_password
      - HOTKEY_PASSWORD=your_hotkey_password

networks:
  subtensor_network:
    driver: bridge
